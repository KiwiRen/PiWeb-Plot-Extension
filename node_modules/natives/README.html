<h1>natives</h1>
<p>Do stuff with Node.js's native JavaScript modules</p>
<h2>Caveat</h2>
<p>Dear Beloved User,</p>
<p>I feel compelled to give you a word of warning if you are considering
using this module.</p>
<p>This module lets you do some creative things with the JavaScript code
in Node.js.  There are some things here that are basically a recipe
for memory leaks, or at the very least, being broken with each new
release of Node, since none of these API surfaces are &quot;technically&quot;
&quot;supported&quot; by the team managing the Node.js project.</p>
<p>This module does not ship a <em>copy</em> of Node's internals.  It does its
thing by using the exposed source code that lives in Node.js itself.
So, running this on different versions of Node.js will produce
different results.</p>
<p>When your program is broken by changes to Node's internals, or when
Node changes in such a way that this module becomes fundamentally
broken, you will likely get little sympathy.  Many people in the Node
community consider this sort of behavior to be unwise and unseemly, if
not outright hostile and morally wrong.</p>
<p>At the very least, you probably just want to run Node with the
(undocumented!) <code>--expose-internals</code> flag, rather than go to such
lengths.</p>
<p>Don't use unless you know what you're doing, or at least, are ok with
the risks.  Don't say I didn't warn you.</p>
<p>Eternally Yours in OSS,<br>
Isaac Z. Schlueter</p>
<h2>USAGE</h2>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> natives = <span class="hljs-built_in">require</span>(<span class="hljs-string">'natives'</span>)

<span class="hljs-comment">// get the source code</span>
<span class="hljs-keyword">var</span> fsCode = natives.source(<span class="hljs-string">'fs'</span>)

<span class="hljs-comment">// get a evaluated copy of the module</span>
<span class="hljs-keyword">var</span> fsCopy = natives.require(<span class="hljs-string">'fs'</span>)

<span class="hljs-comment">// you can pass in a whitelist to NOT shim certain things</span>
<span class="hljs-keyword">var</span> fsCopyWithNativeStreams = natives.require(<span class="hljs-string">'fs'</span>, [<span class="hljs-string">'stream'</span>])

<span class="hljs-comment">// note that this is not the same as the "real" fs</span>
assert(fsCopy !== <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>))

<span class="hljs-comment">// but it does have all the same entries</span>
fsCopy.readFileSync(__filename, <span class="hljs-string">'utf8'</span>) <span class="hljs-comment">// etc</span>
</code></pre>
<h2>Another Caveat</h2>
<p>You can't use this to override <code>require(&quot;buffer&quot;)</code> because everything
depends on <code>Buffer.isBuffer</code> working properly, so it's important for
that one to be given a pass.</p>
